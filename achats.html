<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Test CSV</title>
</head>
<body>

<h2>Test chargement Google Sheet CSV</h2>

<table border="1" id="t"></table>

<script>
const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS80EbOdyJxdT8hmQAux0KJXM-LHsGKFP5eEGQuo28JFid6CwEVCApcOJ-0GpncdDul4Q97VvmjdmTm/pub?output=csv";

fetch(url)
.then(r => r.text())
.then(txt => {

  console.log("CSV reÃ§u:", txt.slice(0,200));

  const rows = txt.split(/\r?\n/).map(r =>
    r.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g)
  );

  const table = document.getElementById("t");

  rows.slice(0,50).forEach(row => {
    if(!row) return;
    const tr = document.createElement("tr");
    row.forEach(c => {
      const td = document.createElement("td");
      td.textContent = c.replace(/^"|"$/g,"");
      tr.appendChild(td);
    });
    table.appendChild(tr);
  });

})
.catch(e => {
  document.body.innerHTML += "<p>ERREUR FETCH: "+e+"</p>";
});
</script>

</body>
</html>
